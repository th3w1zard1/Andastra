# HoloPatcher.NET Rules for AI Agents  
(2025 Edition – Optimized for LLM Performance & Compliance)

## 1. CRITICAL: ALWAYS COMMIT EVERY CHANGE
**Rule #1 – Non-negotiable**  
After ANY file change (create, modify, delete, move):  

```bash
git add <file>  # NEVER git add . or -A
git commit -m "type(scope): message"  # e.g. feat: add K2 camera system
```

Commit format: Conventional Commits  
`fix:`, `feat:`, `refactor:`, `docs:`, `chore:`, `test:`

**Why this works for LLMs**: Clear, measurable, binary success/failure check. LLMs perform best with explicit "do this exact sequence" instructions.

## 2. File Organization (Root Must Stay Clean)
- `docs/` – ALL .md except root `README.md`  
- `scripts/` – ALL .ps1/.sh/.py/.bat  
- Root only allowed: `README.md`, .sln, .csproj, .props, .gitignore, .cursor/rules  

**Action**: If you see misplaced files → move them immediately → commit.

## 3. .NET Target Framework (Cross-Platform Only)
Use ONLY: `net9.0`, `net8.0`, `net7.0`  
**Forbidden**: `net9.0-windows`, `-linux`, `-macos`

## 4. C# Language Version: 7.3 Maximum
**Hard limit**: C# 8+ features banned (nullable refs, switch expr, ranges, using decl, etc.)

**Rewrite pattern (if you see C# 8+)**:  
- `string?` → `string` + `[CanBeNull]` (JetBrains.Annotations)  
- `using var x = ...` → `using (var x = ...) { }`  
- Switch expr → switch statement

## 5. Incomplete Code: ALWAYS Mark with `TODO:` + Type
```csharp
// TODO: STUB - Implement K2 event system (swkotor2.exe: 0x004eb750)
// TODO: PLACEHOLDER - Temporary GFF v3.3 (0x005ac670)
// TODO: FIXME - Memory leak in resource cache
// TODO: SIMPLIFIED - No pathfinding optimization yet
// TODO: HACK - Reflection workaround until API fixed
```

**Why this works**: LLMs love searchability. `TODO:` + type + context is the gold standard for self-documenting code.

## 6. Architecture Rule – New Code vs Existing
**New code ONLY** (everything you write):  
**Prefer conditional logic over inheritance**  
```csharp
if (GameType == GameType.K2) { /* K2 behavior */ }
else if (GameType == GameType.K1) { /* K1 behavior */ }
```

**Existing code**: Leave inheritance alone. Never refactor it.  
**Why**: LLMs get confused by "sometimes use inheritance, sometimes not". Clear rule: new = conditionals, old = keep as-is.

## 7. Reverse Engineering Workflow (Mandatory)
1. Analyze in Ghidra first  
2. Document in Ghidra: rename functions/vars, add comments, prototype  
3. In C#: comment source of truth  
   ```csharp
   // swkotor2.exe: 0x004eb750 – original engine behavior
   if (GameType == GameType.K2) { ... }
   ```

## 8. NSS/NCS Operations
Use `scripts/NcsTool.ps1` for everything (compile, decompile, compare, roundtrip, generate-defs)

## 9. Documentation
- Only public-facing .md → `docs/`  
- No progress reports or internal notes  
- Only what end users/developers need

## 10. Definition of Done (Simple Checklist)
- Code compiles (no warnings)  
- Uses C# 7.3  
- Matches original behavior (Ghidra-verified)  
- All changes committed  
- Files in correct folders  
- Uses `TODO:` for anything unfinished
