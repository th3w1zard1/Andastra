  Determining projects to restore...
  All projects are up-to-date for restore.
  CSharpKOTOR -> G:\GitHub\HoloPatcher.NET\src\CSharpKOTOR\bin\Debug\net9\CSharpKOTOR.dll
  TSLPatcher.Tests -> G:\GitHub\HoloPatcher.NET\src\TSLPatcher.Tests\bin\Debug\net9\TSLPatcher.Tests.dll
Test run for G:\GitHub\HoloPatcher.NET\src\TSLPatcher.Tests\bin\Debug\net9\TSLPatcher.Tests.dll (.NETCoreApp,Version=v9.0)
VSTest version 17.14.1 (x64)

Starting test execution, please wait...
A total of 1 test files matched the specified pattern.
[xUnit.net 00:00:00.00] xUnit.net VSTest Adapter v3.1.5+1b188a7b0a (64-bit .NET 9.0.11)
[xUnit.net 00:00:00.08]   Discovering: TSLPatcher.Tests
[xUnit.net 00:00:00.21]   Discovered:  TSLPatcher.Tests
[xUnit.net 00:00:00.25]   Starting:    TSLPatcher.Tests
=== Preflight Checks ===
Using existing Vanilla_KOTOR_Script_Source repository at: Vanilla_KOTOR_Script_Source
∩┐╜ Found compiler: tools/nwnnsscomp_kscript.exe
∩┐╜ Found K1 nwscript: vendor/PyKotor/vendor/NorthernLights/Scripts/k1_nwscript.nss
∩┐╜ Found TSL nwscript: include/k2_nwscript.nss
∩┐╜ Vanilla repo structure verified
=== Preflight Complete ===
=== Discovering Test Files ===
Found 23318 .nss files
=== Test Discovery Complete ===
=== Running Round-Trip Tests ===
Total NSS scripts to roundtrip test: 23318
Flow: NSS--(external compiler)-->NCS--(internal decompiler)-->NSS--(internal compiler)-->NCS
Fast-fail: enabled (will stop on first bytecode mismatch)
 (external: nwnnsscomp_kscript.exe, variant: TSLPATCHER)     Warning:
     The component "Fluent Assertions" is governed by the rules defined in the Xceed License Agreement and
     the Xceed Fluent Assertions Community License. You may use Fluent Assertions free of charge for
     non-commercial use only. An active subscription is required to use Fluent Assertions for commercial use.
     Please contact Xceed Sales mailto:sales@xceed.com to acquire a subscription at a very low cost.
     A paid commercial license supports the development and continued increasing support of
     Fluent Assertions users under both commercial and community licenses. Help us
     keep Fluent Assertions at the forefront of unit testing.
     For more information, visit https://xceed.com/products/unit-testing/fluent-assertions/
∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜
DECOMPILATION VERBOSE OUTPUT FOR: roundtrip-work/k1/K1/Data/scripts.bif/01_test.ncs
∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜
STDOUT CAPTURE:
read actions.  There were 772
TRACE DecompileNcsObject: START
TRACE DecompileNcsObject: ncs.Instructions count=3
TRACE DecompileNcsObject: actions already loaded
TRACE DecompileNcsObject: Converting NCS to AST, instruction count=3
DEBUG NcsToAstConverter: Converting 3 instructions to AST
DEBUG NcsToAstConverter: No SAVEBP instruction found - no globals subroutine will be created
DEBUG NcsToAstConverter: Converted 2 commands, 0 returned null (range 0-2)
DEBUG NcsToAstConverter: Converted 1 commands, 0 returned null (range 2-3)
TRACE DecompileNcsObject: AST conversion complete, ast=Start
DEBUG AST.ACommandBlock.Apply: sw type=CheckIsGlobals, cmd count=2
DEBUG AST.ACommandBlock.Apply: routing to PrunedReversedDepthFirstAdapter.CaseACommandBlock
TRACE DecompileNcsObject: Getting main subroutine, total subs=1
TRACE DecompileNcsObject: Main subroutine found, type=ASubroutine
DEBUG AST.ACommandBlock.Apply: sw type=FlattenSub, cmd count=2
DEBUG AST.ACommandBlock.Apply: routing to PrunedDepthFirstAdapter.CaseACommandBlock
DEBUG AST.ACommandBlock.Apply: sw type=FlattenSub, cmd count=1
DEBUG AST.ACommandBlock.Apply: routing to PrunedDepthFirstAdapter.CaseACommandBlock
DEBUG FileDecompiler.DecompileNcs: GetGlobalsSub() returned null
DEBUG AST.ACommandBlock.Apply: sw type=CallGraphBuilder, cmd count=1
DEBUG AST.ACommandBlock.Apply: routing to PrunedDepthFirstAdapter.CaseACommandBlock
DEBUG AST.ACommandBlock.Apply: sw type=CallSiteAnalyzer, cmd count=1
DEBUG AST.ACommandBlock.Apply: routing to PrunedDepthFirstAdapter.CaseACommandBlock
DEBUG AST.ACommandBlock.Apply: sw type=MovespParamEstimator, cmd count=1
DEBUG AST.ACommandBlock.Apply: routing to PrunedDepthFirstAdapter.CaseACommandBlock
DEBUG AST.ACommandBlock.Apply: sw type=DoTypes, cmd count=2
DEBUG AST.ACommandBlock.Apply: routing to PrunedDepthFirstAdapter.CaseACommandBlock
DEBUG decompileNcs: Total subroutines in subdata: 1
DEBUG AST.ACommandBlock.Apply: sw type=MainPass, cmd count=1
DEBUG AST.ACommandBlock.Apply: routing to PrunedDepthFirstAdapter.CaseACommandBlock
DEBUG decompileNcs: successfully added subroutine 1
DEBUG AST.ACommandBlock.Apply: sw type=MainPass, cmd count=2
DEBUG AST.ACommandBlock.Apply: routing to PrunedDepthFirstAdapter.CaseACommandBlock
∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜
 (game=k1, output=01_test.dec.nss) ∩┐╜ (85.699 ms, 61 chars)
Recompilation failed: Inbuilt compilation failed for roundtrip-work/k1/K1/Data/scripts.bif/01_test_dec.nss: Unexpected token at top level: NssSeparator at index 3 of 18. Context:
  [0] NssComment: NssComment
  [1] NssSeparator: NewLine
  [2] NssSeparator: NewLine
  [3] NssSeparator: CloseCurlyBrace
  [4] NssSeparator: NewLine
  [5] NssSeparator: NewLine
Decompiled NSS file: roundtrip-work/k1/K1/Data/scripts.bif/01_test_dec.nss
Decompiled NSS preview (first 500 chars):
// Prototypesvoid sub1();void sub1() {
}
void main() {
}
? FAIL K1/Data/scripts.bif/01_test.nss
∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜
FAILURE: K1: K1\Data\scripts.bif\01_test.nss
∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜
Exception: InvalidOperationException
Message:
Recompilation failed - cannot compare bytecode.
Source: K1/Data/scripts.bif/01_test.nss
Recompilation error: Inbuilt compilation failed for roundtrip-work/k1/K1/Data/scripts.bif/01_test_dec.nss: Unexpected token at top level: NssSeparator at index 3 of 18. Context:
  [0] NssComment: NssComment
  [1] NssSeparator: NewLine
  [2] NssSeparator: NewLine
  [3] NssSeparator: CloseCurlyBrace
  [4] NssSeparator: NewLine
  [5] NssSeparator: NewLine
Decompiled NSS: roundtrip-work/k1/K1/Data/scripts.bif/01_test_dec.nss
∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜
∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜
PERFORMANCE SUMMARY
∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜
Total test time: 5.44 seconds
Tests processed: 1 / 23318
Operation breakdown (cumulative):
[xUnit.net 00:00:05.78]     CSharpKOTOR.Tests.Formats.NCSRoundtripTests.TestRoundTripSuite [FAIL]
  compile-original:     0.13 s (  2.4%)
  compile     :     0.61 s ( 11.2%)
  decompile   :     0.09 s (  1.6%)
  compile-roundtrip:     0.48 s (  8.8%)
Profile log: test_profile.txt
∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜
FATAL ERROR: Recompilation failed - cannot compare bytecode.
∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜
Source: K1/Data/scripts.bif/01_test.nss
PERFORMANCE SUMMARY
∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜
Total test time: 5.44 seconds
Tests processed: 1 / 23318
Operation breakdown (cumulative):
Recompilation error: Inbuilt compilation failed for roundtrip-work/k1/K1/Data/scripts.bif/01_test_dec.nss: Unexpected token at top level: NssSeparator at index 3 of 18. Context:
  [0] NssComment: NssComment
  [1] NssSeparator: NewLine
  [2] NssSeparator: NewLine
  [3] NssSeparator: CloseCurlyBrace
  [4] NssSeparator: NewLine
  [5] NssSeparator: NewLine
Decompiled NSS: roundtrip-work/k1/K1/Data/scripts.bif/01_test_dec.nss
  compile-original:     0.13 s (  2.4%)
  compile     :     0.61 s ( 11.2%)
  decompile   :     0.09 s (  1.6%)
  compile-roundtrip:     0.48 s (  8.8%)
Profile log: test_profile.txt
∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜∩┐╜
[xUnit.net 00:00:05.78]       System.InvalidOperationException : Recompilation failed - cannot compare bytecode.
Source: K1/Data/scripts.bif/01_test.nss
Recompilation error: Inbuilt compilation failed for roundtrip-work/k1/K1/Data/scripts.bif/01_test_dec.nss: Unexpected token at top level: NssSeparator at index 3 of 18. Context:
  [0] NssComment: NssComment
  [1] NssSeparator: NewLine
  [2] NssSeparator: NewLine
  [3] NssSeparator: CloseCurlyBrace
  [4] NssSeparator: NewLine
  [5] NssSeparator: NewLine
Decompiled NSS: roundtrip-work/k1/K1/Data/scripts.bif/01_test_dec.nss
[xUnit.net 00:00:05.78]       Stack Trace:
[xUnit.net 00:00:05.78]            at CSharpKOTOR.Tests.Formats.NCSRoundtripTests.RoundTripSingle(String nssPath, String gameFlag, String scratchRoot)
[xUnit.net 00:00:05.78]            at CSharpKOTOR.Tests.Formats.NCSRoundtripTests.TestRoundTripSuite()
[xUnit.net 00:00:05.78]            at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isConstructor)
[xUnit.net 00:00:05.78]            at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)
[xUnit.net 00:00:05.80]   Finished:    TSLPatcher.Tests
  Failed CSharpKOTOR.Tests.Formats.NCSRoundtripTests.TestRoundTripSuite [5 s]
  Error Message:
   System.InvalidOperationException : Recompilation failed - cannot compare bytecode.
Source: K1/Data/scripts.bif/01_test.nss
Recompilation error: Inbuilt compilation failed for roundtrip-work/k1/K1/Data/scripts.bif/01_test_dec.nss: Unexpected token at top level: NssSeparator at index 3 of 18. Context:
  [0] NssComment: NssComment
  [1] NssSeparator: NewLine
  [2] NssSeparator: NewLine
  [3] NssSeparator: CloseCurlyBrace
  [4] NssSeparator: NewLine
  [5] NssSeparator: NewLine
Decompiled NSS: roundtrip-work/k1/K1/Data/scripts.bif/01_test_dec.nss
  Stack Trace:
     at CSharpKOTOR.Tests.Formats.NCSRoundtripTests.RoundTripSingle(String nssPath, String gameFlag, String scratchRoot)
   at CSharpKOTOR.Tests.Formats.NCSRoundtripTests.TestRoundTripSuite()
   at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isConstructor)
   at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)

Test Run Failed.
Total tests: 1
     Failed: 1
 Total time: 7.3159 Seconds
